tmp.dna <- clc.dna %>%
# P15:219019746FD 和 219019748FD
dplyr::filter(sample_id == '219019748FD')
table(tmp.dna$variant_classification)
tmp.dna <- clc.dna %>%
# P34:229001216FD 和 229001221FD
dplyr::filter(sample_id == '229001216FD')
table(tmp.dna$variant_classification)
tmp.dna <- clc.dna %>%
# P34:229001216FD 和 229001221FD
dplyr::filter(sample_id == '229001221FD')
table(tmp.dna$variant_classification)
clc.dna <- clc.dna %>%
dplyr::filter(!sample_id %in% c('219019748FD','229001221FD')) %>%
dplyr::select(-patient_id)
View(clc.dna)
clc.tmb <- clc.dna %>%
dplyr::filter(variant_classification %in% c('In_Frame_Del','In_Frame_Ins','Silent','Targeted_Region',   # Inframe
'Missense_Mutation',                                        # Missense
'Frame_Shift_Del','Frame_Shift_Ins','Nonsense_Mutation','Nonstop_Mutatio','Splice_Site','Splice_Region'  # Truncating
)) %>%
dplyr::select(patient_id,sample_id,variant_classification) %>%
dplyr::group_by(patient_id,sample_id) %>%
dplyr::summarise(tmb = n()) %>%
dplyr::ungroup()
clc.tmb <- clc.dna %>%
dplyr::filter(variant_classification %in% c('In_Frame_Del','In_Frame_Ins','Silent','Targeted_Region',   # Inframe
'Missense_Mutation',                                        # Missense
'Frame_Shift_Del','Frame_Shift_Ins','Nonsense_Mutation','Nonstop_Mutatio','Splice_Site','Splice_Region'  # Truncating
)) %>%
dplyr::select(sample_id,variant_classification) %>%
dplyr::group_by(sample_id) %>%
dplyr::summarise(tmb = n()) %>%
dplyr::ungroup()
View(clc.tmb)
clc.dna <- raw.dna %>%
dplyr::select(patient_id = PatientID,
sample_id  =Tumor_Sample_Barcode,
hugo_symbol = Hugo_Symbol,
chromosome = Chromosome,Start_Position,End_Position,
Variant_Classification,Variant_Type,
Reference_Allele,Tumor_Seq_Allele1,Tumor_Seq_Allele2,
hgvs_c = HGVSc,hgvs_p = HGVSp,hgvs_p_short = HGVSp_Short)
colnames(clc.dna) <- tolower(colnames(clc.dna))
table(clc.dna$variant_classification)
clc.dna <- clc.dna %>%
dplyr::filter(!sample_id %in% c('219019748FD','229001221FD'))
clc.tmb <- clc.dna %>%
dplyr::filter(variant_classification %in% c('In_Frame_Del','In_Frame_Ins','Silent','Targeted_Region',   # Inframe
'Missense_Mutation',                                        # Missense
'Frame_Shift_Del','Frame_Shift_Ins','Nonsense_Mutation','Nonstop_Mutatio','Splice_Site','Splice_Region'  # Truncating
)) %>%
dplyr::select(patient_id,sample_id,variant_classification) %>%
dplyr::group_by(patient_id,sample_id) %>%
dplyr::summarise(tmb = n()) %>%
dplyr::ungroup()
clc.tmb <- clc.dna %>%
dplyr::filter(variant_classification %in% c('In_Frame_Del','In_Frame_Ins','Silent','Targeted_Region',   # Inframe
'Missense_Mutation',                                        # Missense
'Frame_Shift_Del','Frame_Shift_Ins','Nonsense_Mutation','Nonstop_Mutatio','Splice_Site','Splice_Region'  # Truncating
)) %>%
dplyr::select(patient_id,sample_id,variant_classification) %>%
dplyr::group_by(patient_id,sample_id) %>%
dplyr::summarise(tmb = n()) %>%
dplyr::ungroup() %>%
dplyr::mutate(patient_id = gsub("_1","",patient_id))
clc.cli <- clc.cli %>%
dplyr::select(-sample_id) %>%
dplyr::left_join(clc.tmb,by='patient_id') %>%
dplyr::select(patient_id,sample_id,sample_type,cancer,cancer_detail,
age,sex,smoking,stage,
tmb,neoantigen,
chemo_treatment,
ici_treatment,ici_treatment_type,ici_treatment_drug,
orr,
pfs_months,pfs_status,os_months,os_status)
View(clc.cli)
# 表达
raw.rna <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/RNA_count.csv")
dim(raw.rna)
raw.rna[1:5,1:5]
raw.rna <- raw.rna %>%
tibble::column_to_rownames(var = 'PatientID') %>%
t() %>% as.data.frame() %>%
tibble::rownames_to_column(var = 'ENSEMBL')
View(raw.rna)
# 表达
raw.rna <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/RNA_count.csv")
dim(raw.rna)
raw.rna[,1:5]
clc.tmb <- clc.dna %>%
dplyr::filter(variant_classification %in% c('In_Frame_Del','In_Frame_Ins','Silent','Targeted_Region',   # Inframe
'Missense_Mutation',                                        # Missense
'Frame_Shift_Del','Frame_Shift_Ins','Nonsense_Mutation','Nonstop_Mutatio','Splice_Site','Splice_Region'  # Truncating
)) %>%
dplyr::select(patient_id,variant_classification) %>%
dplyr::group_by(patient_id) %>%
dplyr::summarise(tmb = n()) %>%
dplyr::ungroup() %>%
dplyr::mutate(patient_id = gsub("_1","",patient_id))
clc.cli <- raw.cli %>%
dplyr::mutate(pfs_months = ifelse(is.na(progression_date),NA,
as.numeric(difftime(as.Date(as.character(progression_date), format="%Y-%m-%d"),treatment_startdate,units = "days"))/30),
os_months = ifelse(is.na(dead_time),NA,
as.numeric(difftime(as.Date(as.character(dead_time), format="%Y-%m-%d"),treatment_startdate,units = "days"))/30)) %>%
dplyr::select(patient_id = PatientID,
age,
sex,
smoking,
stage,
histology,
chemo_treatment,
ici_treatment,ici_treatment_type,ici_treatment_drug,
orr,
pfs_months,pfs_status,
os_months,os_status) %>%
dplyr::mutate(sex = case_when(sex == 0 ~ 'Male',
sex == 1 ~ 'Female',
TRUE ~ ''),
cancer_detail = ifelse(histology == '腺癌','LUAD',
ifelse(histology == '鳞癌','LUSC',
ifelse(histology == '小细胞癌','SCLC','Others'))),
smoking = case_when(smoking == 0 ~ 'Never',
smoking %in% c(1,2) ~ 'Ever'),
stage = gsub("A|B|C","",stage),
chemo_treatment = case_when(chemo_treatment == '是' ~ 'Yes',
chemo_treatment == '否' ~ 'No',
TRUE ~ ''),
ici_treatment = ifelse(is.na(ici_treatment),'','Yes')
) %>%
dplyr::mutate(sample_id = paste0(patient_id),
sample_type = 'T',
cancer = 'NSCLC'
) %>%
dplyr::left_join(.,raw.tnb %>%
dplyr::select(sample_id = PatientID,
neoantigen = TNB),by='sample_id') %>%
dplyr::select(patient_id,sample_id,sample_type,cancer,cancer_detail,
age,sex,smoking,stage,
neoantigen,
chemo_treatment,
ici_treatment,ici_treatment_type,ici_treatment_drug,
orr,
pfs_months,pfs_status,os_months,os_status
)
# 突变
raw.dna <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/WES_SNV.csv")
colnames(raw.dna)
clc.dna <- raw.dna %>%
dplyr::select(patient_id = PatientID,
sample_id  =Tumor_Sample_Barcode,
hugo_symbol = Hugo_Symbol,
chromosome = Chromosome,Start_Position,End_Position,
Variant_Classification,Variant_Type,
Reference_Allele,Tumor_Seq_Allele1,Tumor_Seq_Allele2,
hgvs_c = HGVSc,hgvs_p = HGVSp,hgvs_p_short = HGVSp_Short)
colnames(clc.dna) <- tolower(colnames(clc.dna))
table(clc.dna$variant_classification)
clc.dna <- clc.dna %>%
dplyr::filter(!sample_id %in% c('219019748FD','229001221FD'))
clc.tmb <- clc.dna %>%
dplyr::filter(variant_classification %in% c('In_Frame_Del','In_Frame_Ins','Silent','Targeted_Region',   # Inframe
'Missense_Mutation',                                        # Missense
'Frame_Shift_Del','Frame_Shift_Ins','Nonsense_Mutation','Nonstop_Mutatio','Splice_Site','Splice_Region'  # Truncating
)) %>%
dplyr::select(patient_id,variant_classification) %>%
dplyr::group_by(patient_id) %>%
dplyr::summarise(tmb = n()) %>%
dplyr::ungroup() %>%
dplyr::mutate(patient_id = gsub("_1","",patient_id))
clc.cli <- clc.cli %>%
# dplyr::select(-sample_id) %>%
dplyr::left_join(clc.tmb,by='patient_id') %>%
dplyr::select(patient_id,sample_id,sample_type,cancer,cancer_detail,
age,sex,smoking,stage,
tmb,neoantigen,
chemo_treatment,
ici_treatment,ici_treatment_type,ici_treatment_drug,
orr,
pfs_months,pfs_status,os_months,os_status)
# 表达
raw.rna <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/RNA_count.csv")
dim(raw.rna)
raw.rna[,1:5]
raw.rna <- raw.rna %>%
tibble::column_to_rownames(var = 'PatientID') %>%
t() %>% as.data.frame() %>%
tibble::rownames_to_column(var = 'ENSEMBL')
# 提取编码RNA等
library(org.Hs.eg.db)
tmp.ids <- AnnotationDbi::select(org.Hs.eg.db, keys=raw.rna$ENSEMBL,keytype="ENSEMBL", columns = c("ENTREZID","SYMBOL"))
length(unique(raw.rna$ENSEMBL))
tmp.ids <- tmp.ids %>%
dplyr::distinct() %>%
dplyr::filter(!is.na(ENTREZID))
clc.rna <- raw.rna %>%
dplyr::inner_join(tmp.ids,.,by='ENSEMBL') %>%
dplyr::select(-ENSEMBL,-ENTREZID) %>%
extract.max('SYMBOL')
clc.rna <- clc.rna %>%
dplyr::arrange(Symbol) %>%
tibble::column_to_rownames(var = 'Symbol')
# count 标准化：log2(CPM(count)+1)
count.data <- clc.rna %>%
as.matrix() %>%
impute::impute.knn()  # 缺失值填充，然后用 sum(is.na(dea.list)) 检查
tmp.rna <- edgeR::cpm(count.data$data)
tmp.rna <- log2(tmp.rna + 0.001)
tmp.rna[1:5,1:10]
# 删除全0行
tmp.rna <- func.removeRowsAllZero(tmp.rna)
clc.rna <- tmp.rna %>%
as.data.frame() %>%
tibble::rownames_to_column(var = 'hugo_symbol')
View(clc.rna)
clc.rna <- tmp.rna %>%
as.data.frame() %>%
tibble::rownames_to_column(var = 'hugo_symbol') %>%
dplyr::select(-P15_2)
colnames(clc.rna) <- gsub("_1","",col(clc.rna))
colnames(clc.rna) <- gsub("_1","",colnames(clc.rna))
colnames(clc.rna) <- gsub("_1|_2","",colnames(clc.rna))
# 更新clc.cli
# 最后在给临床信息表新增测序字段
clc.cli <- clc.cli %>%
dplyr::mutate(has_mutation = ifelse(sample_id %in% clc.dna$sample_id,'Yes','No'),
has_expr = ifelse(sample_id %in% colnames(clc.rna),'Yes','No'),
has_proteome = 'No')
View(clc.dna)
# 突变
raw.dna <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/WES_SNV.csv")
colnames(raw.dna)
clc.dna <- raw.dna %>%
dplyr::select(patient_id = PatientID,
sample_id  =Tumor_Sample_Barcode,
hugo_symbol = Hugo_Symbol,
chromosome = Chromosome,Start_Position,End_Position,
Variant_Classification,Variant_Type,
Reference_Allele,Tumor_Seq_Allele1,Tumor_Seq_Allele2,
hgvs_c = HGVSc,hgvs_p = HGVSp,hgvs_p_short = HGVSp_Short)
colnames(clc.dna) <- tolower(colnames(clc.dna))
table(clc.dna$variant_classification)
{
# 有两个患者分别取了两次样本
tmp.dna <- clc.dna %>%
# P15:219019746FD 和 219019748FD
dplyr::filter(sample_id == '219019748FD')
table(tmp.dna$variant_classification)
# 取219019746FD，突变更多
tmp.dna <- clc.dna %>%
# P34:229001216FD 和 229001221FD
dplyr::filter(sample_id == '229001221FD')
table(tmp.dna$variant_classification)
# 取229001216FD，突变更多
}
clc.dna <- clc.dna %>%
dplyr::filter(!sample_id %in% c('219019748FD','229001221FD'))  %>%
dplyr::select(-sample_id) %>%
dplyr::mutate(sample_id = patient_id)
clc.dna <- raw.dna %>%
dplyr::select(patient_id = PatientID,
sample_id  =Tumor_Sample_Barcode,
hugo_symbol = Hugo_Symbol,
chromosome = Chromosome,Start_Position,End_Position,
Variant_Classification,Variant_Type,
Reference_Allele,Tumor_Seq_Allele1,Tumor_Seq_Allele2,
hgvs_c = HGVSc,hgvs_p = HGVSp,hgvs_p_short = HGVSp_Short)
colnames(clc.dna) <- tolower(colnames(clc.dna))
table(clc.dna$variant_classification)
{
# 有两个患者分别取了两次样本
tmp.dna <- clc.dna %>%
# P15:219019746FD 和 219019748FD
dplyr::filter(sample_id == '219019748FD')
table(tmp.dna$variant_classification)
# 取219019746FD，突变更多
tmp.dna <- clc.dna %>%
# P34:229001216FD 和 229001221FD
dplyr::filter(sample_id == '229001221FD')
table(tmp.dna$variant_classification)
# 取229001216FD，突变更多
}
clc.dna <- clc.dna %>%
dplyr::filter(!sample_id %in% c('219019748FD','229001221FD'))  %>%
dplyr::select(-sample_id) %>%
dplyr::rename(sample_id = patient_id)
clc.tmb <- clc.dna %>%
dplyr::filter(variant_classification %in% c('In_Frame_Del','In_Frame_Ins','Silent','Targeted_Region',   # Inframe
'Missense_Mutation',                                        # Missense
'Frame_Shift_Del','Frame_Shift_Ins','Nonsense_Mutation','Nonstop_Mutatio','Splice_Site','Splice_Region'  # Truncating
)) %>%
dplyr::select(sample_id,variant_classification) %>%
dplyr::group_by(sample_id) %>%
dplyr::summarise(tmb = n()) %>%
dplyr::ungroup() %>%
dplyr::mutate(sample_id = gsub("_1","",sample_id))
# 临床信息
raw.cli <- openxlsx::read.xlsx("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/clinical.xlsx",
sheet = 2,detectDates = T)
raw.tnb <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/WES_TNB.csv")
colnames(raw.cli)
rm(list = ls())
gc()
options(stringsAsFactors = F)
library(magrittr)
library(RMySQL)
library(openxlsx)
library(dplyr)
library(DESeq2)
# 关闭多有sql连接,注释是否会影响别的项目？
killDbConnections <- function () {
all_cons <- dbListConnections(MySQL())
print(all_cons)
for(con in all_cons)
+  dbDisconnect(con)
print(paste(length(all_cons), " connections killed."))
}
killDbConnections()
# Quark
con <- dbConnect(MySQL(),host="127.0.0.1", # 127.0.0.1
dbname="icbcohorts", # icbcohorts
user="icbuser",   # icbuser
password="ICB2021")  # ICB2021
#获取连接信息，查看database下所有表
summary(con)
# dbGetInfo(con)
dbListTables(con)
# 同名探针取中位值最大者
extract.max <- function(raw.rna,col.name){
# raw.rna: 第一列为 Symbol，第二列开始为样本名
clc.rna <- raw.rna %>%
dplyr::rename(Symbol = col.name)
# 重复symbol按照中位值排序，取最高者
temp.df <- clc.rna[,-1]
clc.rna <- clc.rna[!apply(temp.df,1,sum,na.rm =T)==0,]
# 去除重复基因名的行，归一化
clc.rna$median <- apply(clc.rna[,-1],1,median,na.rm = T)  # 对不包含第一列的数据按行取中位值赋值给新的一列
clc.rna <- clc.rna[order(clc.rna$Symbol,clc.rna$median,decreasing = T),]  # 根据基因名和中位值降序排序
clc.rna <- clc.rna[!duplicated(clc.rna$Symbol),]  # 删除基因名重复的记录，取一
clc.rna <- clc.rna %>%
dplyr::select(-median)
rownames(clc.rna) <- seq(nrow(clc.rna))
return(clc.rna)
}
# 删除全为0 的行
func.removeRowsAllZero  <- function(x){
del0.df <- x[apply(x, 1, function(y) any(!sum(y) == 0)),]
return(del0.df)
}
# 临床信息
raw.cli <- openxlsx::read.xlsx("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/clinical.xlsx",
sheet = 2,detectDates = T)
raw.tnb <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/WES_TNB.csv")
colnames(raw.cli)
table(raw.cli$histology)
clc.cli <- raw.cli %>%
dplyr::mutate(pfs_months = ifelse(is.na(progression_date),NA,
as.numeric(difftime(as.Date(as.character(progression_date), format="%Y-%m-%d"),treatment_startdate,units = "days"))/30),
os_months = ifelse(is.na(dead_time),NA,
as.numeric(difftime(as.Date(as.character(dead_time), format="%Y-%m-%d"),treatment_startdate,units = "days"))/30)) %>%
dplyr::select(patient_id = PatientID,
age,
sex,
smoking,
stage,
histology,
chemo_treatment,
ici_treatment,ici_treatment_type,ici_treatment_drug,
orr,
pfs_months,pfs_status,
os_months,os_status) %>%
dplyr::mutate(sex = case_when(sex == 0 ~ 'Male',
sex == 1 ~ 'Female',
TRUE ~ ''),
cancer_detail = ifelse(histology == '腺癌','LUAD',
ifelse(histology == '鳞癌','LUSC',
ifelse(histology == '小细胞癌','SCLC','Others'))),
smoking = case_when(smoking == 0 ~ 'Never',
smoking %in% c(1,2) ~ 'Ever'),
stage = gsub("A|B|C","",stage),
chemo_treatment = case_when(chemo_treatment == '是' ~ 'Yes',
chemo_treatment == '否' ~ 'No',
TRUE ~ ''),
ici_treatment = ifelse(is.na(ici_treatment),'','Yes')
) %>%
dplyr::mutate(sample_id = paste0(patient_id),
sample_type = 'T',
cancer = 'NSCLC'
) %>%
dplyr::left_join(.,raw.tnb %>%
dplyr::select(sample_id = PatientID,
neoantigen = TNB),by='sample_id') %>%
dplyr::select(patient_id,sample_id,sample_type,cancer,cancer_detail,
age,sex,smoking,stage,
neoantigen,
chemo_treatment,
ici_treatment,ici_treatment_type,ici_treatment_drug,
orr,
pfs_months,pfs_status,os_months,os_status
)
# 突变
raw.dna <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/WES_SNV.csv")
colnames(raw.dna)
clc.dna <- raw.dna %>%
dplyr::select(patient_id = PatientID,
sample_id  =Tumor_Sample_Barcode,
hugo_symbol = Hugo_Symbol,
chromosome = Chromosome,Start_Position,End_Position,
Variant_Classification,Variant_Type,
Reference_Allele,Tumor_Seq_Allele1,Tumor_Seq_Allele2,
hgvs_c = HGVSc,hgvs_p = HGVSp,hgvs_p_short = HGVSp_Short)
colnames(clc.dna) <- tolower(colnames(clc.dna))
table(clc.dna$variant_classification)
{
# 有两个患者分别取了两次样本
tmp.dna <- clc.dna %>%
# P15:219019746FD 和 219019748FD
dplyr::filter(sample_id == '219019748FD')
table(tmp.dna$variant_classification)
# 取219019746FD，突变更多
tmp.dna <- clc.dna %>%
# P34:229001216FD 和 229001221FD
dplyr::filter(sample_id == '229001221FD')
table(tmp.dna$variant_classification)
# 取229001216FD，突变更多
}
clc.dna <- clc.dna %>%
dplyr::filter(!sample_id %in% c('219019748FD','229001221FD'))  %>%
dplyr::select(-sample_id) %>%
dplyr::rename(sample_id = patient_id)
clc.tmb <- clc.dna %>%
dplyr::filter(variant_classification %in% c('In_Frame_Del','In_Frame_Ins','Silent','Targeted_Region',   # Inframe
'Missense_Mutation',                                        # Missense
'Frame_Shift_Del','Frame_Shift_Ins','Nonsense_Mutation','Nonstop_Mutatio','Splice_Site','Splice_Region'  # Truncating
)) %>%
dplyr::select(sample_id,variant_classification) %>%
dplyr::group_by(sample_id) %>%
dplyr::summarise(tmb = n()) %>%
dplyr::ungroup() %>%
dplyr::mutate(sample_id = gsub("_1","",sample_id))
clc.cli <- clc.cli %>%
# dplyr::select(-sample_id) %>%
dplyr::left_join(clc.tmb,by='patient_id') %>%
dplyr::select(patient_id,sample_id,sample_type,cancer,cancer_detail,
age,sex,smoking,stage,
tmb,neoantigen,
chemo_treatment,
ici_treatment,ici_treatment_type,ici_treatment_drug,
orr,
pfs_months,pfs_status,os_months,os_status)
clc.cli <- clc.cli %>%
# dplyr::select(-sample_id) %>%
dplyr::left_join(clc.tmb,by='sample_id') %>%
dplyr::select(patient_id,sample_id,sample_type,cancer,cancer_detail,
age,sex,smoking,stage,
tmb,neoantigen,
chemo_treatment,
ici_treatment,ici_treatment_type,ici_treatment_drug,
orr,
pfs_months,pfs_status,os_months,os_status)
# 表达
raw.rna <- data.table::fread("../../../../../Biodatas/ICIcohorts/A.NSCLC_Wang2022_WES_RNAseq/RNA_count.csv")
dim(raw.rna)
raw.rna[,1:5]
raw.rna <- raw.rna %>%
tibble::column_to_rownames(var = 'PatientID') %>%
t() %>% as.data.frame() %>%
tibble::rownames_to_column(var = 'ENSEMBL')
# 提取编码RNA等
library(org.Hs.eg.db)
tmp.ids <- AnnotationDbi::select(org.Hs.eg.db, keys=raw.rna$ENSEMBL,keytype="ENSEMBL", columns = c("ENTREZID","SYMBOL"))
length(unique(raw.rna$ENSEMBL))
tmp.ids <- tmp.ids %>%
dplyr::distinct() %>%
dplyr::filter(!is.na(ENTREZID))
clc.rna <- raw.rna %>%
dplyr::inner_join(tmp.ids,.,by='ENSEMBL') %>%
dplyr::select(-ENSEMBL,-ENTREZID) %>%
extract.max('SYMBOL')
clc.rna <- clc.rna %>%
dplyr::arrange(Symbol) %>%
tibble::column_to_rownames(var = 'Symbol')
# count 标准化：log2(CPM(count)+1)
count.data <- clc.rna %>%
as.matrix() %>%
impute::impute.knn()  # 缺失值填充，然后用 sum(is.na(dea.list)) 检查
tmp.rna <- edgeR::cpm(count.data$data)
tmp.rna <- log2(tmp.rna + 0.001)
tmp.rna[1:5,1:10]
# 删除全0行
tmp.rna <- func.removeRowsAllZero(tmp.rna)
clc.rna <- tmp.rna %>%
as.data.frame() %>%
tibble::rownames_to_column(var = 'hugo_symbol') %>%
dplyr::select(-P15_2)
colnames(clc.rna) <- gsub("_1|_2","",colnames(clc.rna))
# 更新clc.cli
# 最后在给临床信息表新增测序字段
clc.cli <- clc.cli %>%
dplyr::mutate(has_mutation = ifelse(sample_id %in% clc.dna$sample_id,'Yes','No'),
has_expr = ifelse(sample_id %in% colnames(clc.rna),'Yes','No'),
has_proteome = 'No')
length(unique(clc.dna$sample_id))
table(clc.cli$has_mutation)
table(clc.cli$has_expr) # 发现有表达的样本基本没有生存数据！因此不纳入EPITOME
View(clc.cli)
# 数据入表
cohort.name <- "wang_2021"
dbWriteTable(con,paste0(cohort.name,"_clinical"),clc.cli,overwrite = T,row.names = F)
dbWriteTable(con,paste0(cohort.name,"_mutation"),clc.dna,overwrite = T,row.names = F)
dbWriteTable(con,paste0(cohort.name,"_expr"),clc.rna,overwrite = T,row.names = F)
table(clc.cli$cancer_detail)
